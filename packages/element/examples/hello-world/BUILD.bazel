load("@build_bazel_rules_nodejs//:index.bzl", "pkg_web")
load("@npm//http-server:index.bzl", "http_server")
load("@npm_bazel_rollup//:index.bzl", "rollup_bundle")
load("@npm_bazel_terser//:index.bzl", "terser_minified")
load("@npm_bazel_typescript//:index.bzl", "ts_devserver")
load("//tools:defaults.bzl", "ng_module", "ng_package", "ng_rollup_bundle", "ts_library")

package(default_visibility = ["//visibility:private"])

ng_module(
  name = "hello_world",
  srcs = ["hello-world.ts"],
  assets = [
    "hello-world.html",
    "hello-world.css"
  ],
  deps = [
    "//packages/core"
  ]
)

ts_library(
  name = "hello_world_element",
  srcs = ["index.ts"],
  deps = [
    ":hello_world",
    "//packages/element",
    "//packages/core"
  ]
)
rollup_bundle(
  name = "bundle",
  entry_point = "index.ts",
  config_file = "rollup.config.js",
  deps = [
    "//packages/core",
    "//packages/element",
    ":hello_world_element",
    ":hello_world",
    "@npm//rollup-plugin-commonjs",
    "@npm//rollup-plugin-node-resolve",
    "@npm//@angular-devkit/build-optimizer"
  ]
)

terser_minified(
    name = "bundle.min",
    src = ":bundle",
    config_file = "terser.config.json"
)

pkg_web(
    name = "web_package",
    srcs = [
        "index.html",
        ":bundle.min",
    ],
)

http_server(
    name = "prodserver",
    data = [":web_package"],
    templated_args = ["packages/element/examples/hello-world/web_package"],
)
